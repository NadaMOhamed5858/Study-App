{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-4" dir="rtl" style="text-align: right;">
    <div class="row">
        <div class="col-md-8">
            <div class="card shadow-lg border-0 rounded-4 mb-4 p-4" style="background: #ffffff;">
                <div class="d-flex align-items-center mb-4">
                    <div class="bg-primary text-white p-3 rounded-4 ms-3 shadow">
                        <i class="fas fa-microchip fa-2x"></i>
                    </div>
                    <div>
                        <h2 class="fw-bold text-dark mb-0">Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ Ø¨Ø´Ù…Ù‡Ù†Ø¯Ø³Ø© {{ user.name }} ğŸ—ï¸</h2>
                        <p class="text-primary fw-bold mb-0">ØªØ­Ù„ÙŠÙ„ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ÙŠÙˆÙ… {{ today }}</p>
                    </div>
                </div>

                <div class="study-plan-container p-4 rounded-4 shadow-sm"
                    style="background: #f8f9fa; border-right: 5px solid #0d6efd;">
                    <div id="ai-response-content" class="lh-lg">
                        {{ ai_plan | safe}}
                    </div>
                </div>

                <div class="mt-4 p-3 bg-light rounded-4 border">
                    <small class="text-muted">
                        <i class="fas fa-lightbulb text-warning me-1"></i>
                        Ù†ØµÙŠØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ: Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø¯Ù‡ Ù…ØªØ­Ø¯Ø« Ù„Ø¹Ø§Ù… 2026ØŒ Ø±ÙƒØ²ÙŠ ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù€ 20 Ù„Ø£Ù†Ù‡Ø§ Ø¨ØªØºØ·ÙŠ Ø£ÙÙƒØ§Ø±
                        Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.
                    </small>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-lg border-0 rounded-4 sticky-top" style="top: 20px;">
                <div class="card-header bg-dark text-white py-3 d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-robot ms-2"></i> Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ (Gemini)</span>
                    <span class="badge bg-success">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</span>
                </div>
                <div id="chat-box" style="height: 500px; overflow-y: auto; padding: 20px; background: #ffffff;">
                    <div class="text-start mb-3">
                        <div class="p-3 bg-light rounded-4 d-inline-block shadow-sm" style="max-width: 90%;">
                            Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ Ù…Ù„Ø§Ùƒ! Ø£Ù†Ø§ Ø­Ù…Ù„Øª Ù…Ù†Ù‡Ø¬ {{ user.stage }} Ù„Ø¹Ø§Ù… 2026. ØªØ­Ø¨ÙŠ Ø£Ø´Ø±Ø­Ù„Ùƒ Ù†Ù‚Ø·Ø© Ù…Ø¹ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                            Ø§Ù„Ù€ 20ØŸ
                        </div>
                    </div>
                </div>
                <div class="p-3 border-top bg-white">
                    <div class="input-group shadow-sm rounded-pill overflow-hidden">
                        <input type="text" id="chat-input" class="form-control border-0 px-4"
                            placeholder="Ø§Ø³Ø£Ù„ÙŠ Ø§Ù„Ù€ AI Ø¹Ù† Ø§Ù„Ù…Ù†Ù‡Ø¬...">
                        <button class="btn btn-primary" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    #ai-response-content b,
    #ai-response-content strong {
        color: #0d6efd;
        font-size: 1.1rem;
    }

    .study-plan-container {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #chat-box::-webkit-scrollbar {
        width: 5px;
    }

    #chat-box::-webkit-scrollbar-thumb {
        background: #eee;
        border-radius: 10px;
    }
</style>

<script>
    function sendMessage() {
        let input = document.getElementById('chat-input');
        let box = document.getElementById('chat-box');
        if (!input.value) return;

        let userMsg = input.value;
        box.innerHTML += `<div class="text-end mb-3"><div class="p-3 bg-primary text-white rounded-4 d-inline-block shadow-sm">${userMsg}</div></div>`;
        input.value = '';
        box.scrollTop = box.scrollHeight;

        fetch('/ask-bot', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: userMsg })
        })
            .then(r => r.json())
            .then(data => {
                box.innerHTML += `<div class="text-start mb-3"><div class="p-3 bg-white border rounded-4 d-inline-block shadow-sm" style="max-width: 90%;"><strong>Ø§Ù„Ù€ AI:</strong> ${data.reply.replace(/\n/g, '<br>')}</div></div>`;
                box.scrollTop = box.scrollHeight;
            });
    }
</script>
{% endblock %}